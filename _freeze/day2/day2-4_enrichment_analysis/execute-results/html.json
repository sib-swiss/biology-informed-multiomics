{
  "hash": "f7b1c22937817efa4780e60ae25cf874",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Exercise 7\"\neditor: source\neditor_options: \n  chunk_output_type: console\n---\n\n# Enrichment analysis\n\n## Load Libraries\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rGREAT)\nlibrary(TxDb.Mmusculus.UCSC.mm10.knownGene)\nlibrary(org.Mm.eg.db)\nlibrary(simplifyEnrichment)\nlibrary(flexclust)\n```\n:::\n\n\n\n\n## OverlapMatrix\n\n::: {.cell}\n\n```{.r .cell-code}\noverlap <- readRDS(\"output/overlap_anno2.rds\")\n```\n:::\n\n\nWe have several cluster of genomic activities. We will run enrichment analysis of regions from one of them, \"Active Promoters\".\n\n## Running enrichment analysis on regions of our interest\n\n### subset the `GRanges`\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngr <- overlap[overlap$ATAC_RNA == \"Active Promoters\"]\nseqlevels(gr) <- as.character(unique(seqnames(gr)))\n```\n:::\n\n\n\n### Running enrichment analysis\n\n::: {.cell}\n\n```{.r .cell-code}\nres <- great(gr = gr, gene_sets = \"BP\", tss_source = \"mm10\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n* TSS source: TxDb.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n* check whether TxDb package 'TxDb.Mmusculus.UCSC.mm10.knownGene' is installed.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n* gene ID type in the extended TSS is 'Entrez Gene ID'.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n* restrict chromosomes to 'chr1, chr2, chr3, chr4, chr5, chr6, chr7, chr8, chr9, chr10,\n    chr11, chr12, chr13, chr14, chr15, chr16, chr17, chr18, chr19, chrX, chrY, chrM'.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n* 20593/24515 protein-coding genes left.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n* update seqinfo to the selected chromosomes.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n* TSS extension mode is 'basalPlusExt'.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n* construct the basal domains by extending 5000bp to upstream and 1000bp to downsteram of TSS.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n* calculate distances to neighbour regions.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n* extend to both sides until reaching the neighbour genes or to the maximal extension.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n* use GO:BP ontology with 15445 gene sets (source: org.Mm.eg.db).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n* check gene ID type in `gene_sets` and in `extended_tss`.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n* use whole genome as background.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n* remove excluded regions from background.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n* overlap `gr` to background regions (based on midpoint).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n* in total 99 `gr`.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n* overlap extended TSS to background regions.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n* check which genes are in the gene sets.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n* only take gene sets with size >= 5.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n* in total 9412 gene sets.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n* overlap `gr` to every extended TSS.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n* perform binomial test for each biological term.\n```\n\n\n:::\n:::\n\n\n## Results\n\n### Volcano plot\n\n::: {.cell}\n\n```{.r .cell-code}\nplotVolcano(res)\n```\n\n::: {.cell-output-display}\n![](day2-4_enrichment_analysis_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n### Regions-gene assiciation plot\n\n::: {.cell}\n\n```{.r .cell-code}\nplotRegionGeneAssociations(res)\n```\n\n::: {.cell-output-display}\n![](day2-4_enrichment_analysis_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n### There is a `shiny` application to explore the results\n\n::: {.cell}\n\n```{.r .cell-code}\nshinyReport(res)\n```\n:::\n\n\n### Simplyfied representation of GO terms\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntb <- getEnrichmentTable(res)\nsig_go_ids <- tb$id[tb$p_adjust < 0.05]\ncl <- simplifyGO(mat = sig_go_ids)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nYou haven't provided value for `ont`, guess it as `BP`.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nrelations: is_a, part_of, regulates, negatively_regulates, positively_regulates\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIC_method: IC_annotation\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nterm_sim_method: Sim_XGraSM_2013\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIC_method: IC_annotation\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCluster 33 terms by 'binary_cut'... 4 clusters, used 0.1181722 secs.\n'magick' package is suggested to install to give better rasterization.\n\nSet `ht_opt$message = FALSE` to turn off this message.\nPerform keywords enrichment for 4 GO lists...\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](day2-4_enrichment_analysis_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummarizeGO(go_id = sig_go_ids, -log10(tb$p_adjust[tb$p_adjust < 0.05]), \n            axis_label = \"average -log10(p.adjust)\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nYou haven't provided value for `ont`, guess it as `BP`.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nterm_sim_method: Sim_XGraSM_2013\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIC_method: IC_annotation\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCluster 33 terms by 'binary_cut'... 4 clusters, used 0.1288469 secs.\nPerform keywords enrichment for 4 GO lists...\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](day2-4_enrichment_analysis_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n### Output\n:::{.callout-important}\n- The heatmap shows clear clustering of GO terms into two main clusters, indicating distinct functional groups.\n\n- The GO terms on the right highlight biological processes relevant to neuronal and ion transport functions, such as transport, inorganic cation ion, exocytosis, synaptic, neurotransmitter, and behavior learning.\n\n- The cluster with terms like cytosolic concentration, calcium ion suggests a calcium-related signaling or ion homeostasis process at play.\n\n- The color gradient and similarity scores (up to ~0.6) indicate moderate similarity within clusters, which is reasonable for GO term groupings.\n:::\n\n### Interpretation\n:::{.callout-important}\n- E11.5 to E15.5 is a key window in neural development involving neuronal differentiation, synapse formation, and active signaling.\n\n- Active promoters linked to ion transport, synaptic transmission, calcium signaling are expected to be regulated during this developmental stage.\n\n- The clustering separating signaling and transport-related terms from behavior and learning terms also aligns with early neural circuit formation and functional maturation.\n:::\n\n\n## Question\n\n**Perform enrichment analysis of any other category.**",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}