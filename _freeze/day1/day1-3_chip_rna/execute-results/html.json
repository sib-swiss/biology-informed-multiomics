{
  "hash": "a86358706a6df3b81f1d4da2af26bc20",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Exercise 3\"\neditor: source\neditor_options: \n  chunk_output_type: console\n---\n\n# ChIP and RNA sequencing data plots\n\n## Learning Objectives\nBy the end of this exercise, you will be able to:\n\n- Load and explore `SummarizedExperiment` objects for ChIP-seq and RNA-seq data.\n- Visualize ChIP-seq signal enrichment across genomic regions using the `EnrichedHeatmap` package.\n- Generate and interpret RNA-seq expression heatmaps using the `ComplexHeatmap` package.\n- Transform RNA-seq data to highlight differential expression using log fold-change.\n- Annotate heatmaps with sample metadata to enhance interpretability.\n- Split and visualize RNA-seq data based on gene regulation status (up- or down-regulated).\n- Compare and reflect on the similarities and differences in visualization techniques between ChIP-seq and RNA-seq data.\n\n\n## Load Libraries\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(SummarizedExperiment)\nlibrary(EnrichedHeatmap)\nlibrary(gUtils)\nlibrary(rtracklayer)\nlibrary(circlize)\n```\n:::\n\n\n\n## ChIP-seq SE object\nHere we load the `SummarizedExperiment` for the ChIP-seq data\n\n::: {.cell}\n\n```{.r .cell-code}\nh3k4me3 <- readRDS(\"data/h3k4me3_se.rds\")\nh3k4me1 <- readRDS(\"data/h3k4me1_se.rds\")\nh3k27me3 <- readRDS(\"data/h3k27me3_se.rds\")\nh3k27ac <- readRDS(\"data/h3k27ac_se.rds\")\n```\n:::\n\n\n## Question 1\n\n**Similar to ATAC-seq data, please create `EnrichedHeatmap` for all ChIP-seq datasets and observe difference in genome activity at different genomic regions.**\n\n\n## RNA-seq data\n\n::: {.cell}\n\n```{.r .cell-code}\nrna <- readRDS(\"data/rna_se.rds\")\n```\n:::\n\n\n## Heatmap of counts\nFor RNA-seq data, we use `ComplexHeatmap` package to make heatmaps\n\n\n::: {.cell}\n\n```{.r .cell-code}\nHeatmap(matrix = assay(rna, \"logCPM\"), \n        name = \"RNA\", \n        cluster_columns = FALSE, \n        show_row_names = FALSE\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: The input is a data frame-like object, convert it to a matrix.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](day1-3_chip_rna_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n### Changing visualization to fold change\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncounts <- assay(rna, \"logCPM\") - rowMeans(\n  assay(rna, \"logCPM\")[, grep(pattern = \"11half\", x = colnames(assay(rna, \"logCPM\")),\n                              value = T)]\n)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nHeatmap(matrix = counts, \n        name = \"RNA\", \n        cluster_columns = FALSE, \n        show_row_names = FALSE\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: The input is a data frame-like object, convert it to a matrix.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](day1-3_chip_rna_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nIt is now more clear, which genes are up-regulated and which are down-regulated.\n\n### Adding colum annotations\n\n::: {.cell}\n\n```{.r .cell-code}\ncolData(rna)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nDataFrame with 4 rows and 2 columns\n                                 sample    group\n                            <character> <factor>\nRNA_11half_1.tsv.gz RNA_11half_1.tsv.gz   11half\nRNA_11half_2.tsv.gz RNA_11half_2.tsv.gz   11half\nRNA_15half_1.tsv.gz RNA_15half_1.tsv.gz   15half\nRNA_15half_2.tsv.gz RNA_15half_2.tsv.gz   15half\n```\n\n\n:::\n:::\n\n\nWe can add groups information to the heatmap\n\n::: {.cell}\n\n```{.r .cell-code}\nHeatmap(matrix = counts, \n        name = \"RNA\", \n        cluster_columns = FALSE, \n        show_row_names = FALSE, \n        show_column_names = FALSE,\n        top_annotation = HeatmapAnnotation(df = colData(rna)[,2,drop = FALSE]),\n        width = unit(4, \"cm\"),\n        height = unit(8, \"cm\"),\n        heatmap_legend_param = list(\n            at = scales::pretty_breaks(n = 3)(range(counts, na.rm = TRUE)), \n            title = \"RNA\"\n        )\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: The input is a data frame-like object, convert it to a matrix.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](day1-3_chip_rna_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n## Question 2\n\n**Similar to `EnrichedHeatmap`, we can also split RNA-seq data based on logFC. Can you try to do this?**\n\n:::{.callout-tip collapse=\"true\"}\n\n::: {.cell}\n\n```{.r .cell-code}\nlogFC <- rowData(rna)[,\"logFC\"]\nnames(logFC) <- rownames(rowData(rna))\n\nlogFC <- ifelse(logFC > 0, \"Up regulated\", \"Down regulated\")\n\nHeatmap(matrix = counts, \n        name = \"RNA\", \n        cluster_columns = FALSE, \n        show_row_names = FALSE, \n        show_column_names = FALSE,\n        top_annotation = HeatmapAnnotation(df = colData(rna)[,2,drop = FALSE]),\n        width = unit(4, \"cm\"),\n        height = unit(8, \"cm\"),\n        heatmap_legend_param = list(\n            at = scales::pretty_breaks(n = 3)(range(counts, na.rm = TRUE)), \n            title = \"RNA\"\n        ),\n        row_split = logFC\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: The input is a data frame-like object, convert it to a matrix.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](day1-3_chip_rna_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n:::\n\n:::{.callout-important}\n**`Heatmap` and `EnrichedHeatmap` have a lot of options in common.**\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}